name: Fetch AOE2 Personal Stats

on:
  workflow_dispatch:

jobs:
  fetch-stats:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout repository
      uses: actions/checkout@v2

    - name: Set up Node.js
      uses: actions/setup-node@v2
      with:
        node-version: '16'

    - name: Install dependencies
      run: npm install axios

    - name: Fetch AOE2 Personal Stats
      run: |
        const axios = require('axios');
        const fs = require('fs');

        axios.get('https://aoe-api.reliclink.com/community/leaderboard/GetPersonalStat?title=age2&profile_names=["%2Fsteam%2F76561198067966567"]')
          .then(response => {
            console.log(response.data);
            fs.writeFileSync('aoe2_personal_stats.json', JSON.stringify(response.data, null, 2));
          })
          .catch(error => {
            console.error(error);
            process.exit(1);
          });

    - name: Upload JSON output
      uses: actions/upload-artifact@v2
      with:
        name: aoe2_personal_stats
        path: aoe2_personal_stats.json
