<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Wololo</title>
    <link rel="icon" href="https://raw.githubusercontent.com/inertiacreeping/wololo/main/favicon.png" type="image/png">
    <style>
        body {
            background-color: #ffe4e1; /* light red */
            font-family: 'Courier New', Courier, monospace;
            color: #fff; /* white text */
            text-align: center;
            padding: 50px;
            overflow: hidden;
        }
        .container {
            border: 5px solid #8b0000; /* dark red */
            padding: 20px;
            display: inline-block;
            background-color: #ff6347; /* tomato red */
            box-shadow: 10px 10px 5px #888888;
            max-width: 800px;
            margin: auto;
            position: relative;
            z-index: 1;
        }
        h1 {
            color: #fff; /* white text */
            font-size: 3em;
        }
        p {
            font-size: 1.2em;
            color: #fff; /* white text */
        }
        .player-list {
            text-align: left;
            margin-top: 30px;
        }
        .player {
            margin-bottom: 20px;
        }
        .player h2 {
            margin: 10px 0;
            display: inline-block;
            font-size: 1.2em;
            color: #fff; /* white text */
        }
        .elo {
            font-size: 1em;
            color: #fff; /* white text */
        }
        .live-status {
            display: inline-block;
            margin-left: 10px;
            font-weight: bold;
            font-size: 1.2em;
        }
        .icon {
            width: 24px;
            height: 24px;
            vertical-align: middle;
            margin: 0 5px;
        }
        .discord-name {
            font-size: 1.2em;
        }
        .player-info {
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        .player-info div {
            flex: 1;
        }
        .discord-button, .twitch-button {
            display: flex;
            align-items: center;
            background-color: #000;
            color: #fff;
            font-weight: bold;
            padding: 5px 10px;
            border-radius: 5px;
            text-decoration: none;
            max-width: 190px;
            white-space: nowrap;
        }
        .discord-button img, .twitch-button img {
            margin-right: 5px;
        }
        .twitch-button {
            background-color: #593e84; /* Updated Twitch background color */
        }
        .twitch-button.offline {
            color: gray;
        }
        .live-text {
            color: white;
            font-weight: bold;
        }
        .live-text.flash {
            animation: flash 1s infinite;
        }
        @keyframes flash {
            0%, 50%, 100% {
                color: red;
            }
            25%, 75% {
                color: white;
            }
        }
        .audio-button {
            display: inline-block;
            margin-top: 20px;
            padding: 10px 20px;
            font-size: 1.5em;
            color: #fff;
            background-color: #8b0000;
            text-decoration: none;
            border-radius: 10px;
            cursor: pointer;
        }
        /* Blue Theme */
        .blue-theme body {
            background-color: #e0f7fa; /* light blue */
            color: #fff; /* white text */
        }
        .blue-theme .container {
            border: 5px solid #00008b; /* dark blue */
            background-color: #4682b4; /* steel blue */
        }
        .blue-theme h1 {
            color: #fff; /* white text */
        }
        .blue-theme .audio-button {
            background-color: #00008b;
        }
        #fireworks-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 0;
        }
    </style>
</head>
<body>
<div id="fireworks-container"></div>
<div class="container">
    <h1>wololo</h1>
    <p>Hi there, if you've been given this URL in game, this page helps you find us so we can hang out some more!</p>
    <div id="player-list" class="player-list"></div>
    <button class="audio-button" onclick="playAudio()">Wololo!</button>
</div>
<audio id="wololo-audio" src="https://github.com/inertiacreeping/wololo/blob/86d3d2a207c1a56970b48878cdbba47c180372e6/wololo.mp3?raw=true"></audio>
<script src="https://cdn.jsdelivr.net/npm/fireworks-js/dist/fireworks.js"></script>
<script>
    const players = [{
        name: 'inertiacreeping',
        twitch: 'https://www.twitch.tv/inertiacreeping',
        discordName: 'Low ELO Legends',
        discordLink: 'https://discord.gg/XXvQE4uY2m',
        steamID: '/steam/76561198067966567'
    },
    {
        name: 'shiderplays',
        twitch: 'https://www.twitch.tv/shiderplays',
        discordName: 'ShiderPlays',
        discordLink: 'https://discord.gg/dzXthPsvKQ',
        steamID: '/steam/76561198151727332'
    },
    {
        name: 'tambow',
        twitch: 'https://www.twitch.tv/ttambow',
        discordName: 'tambourine town',
        discordLink: 'https://discord.gg/yfyw3ZRUua',
        steamID: '/steam/76561198040642066'
    },
    {
        name: 'chestnutplace77',
        twitch: 'https://www.twitch.tv/chestnutplace77',
        discordName: 'the nutshack',
        discordLink: 'https://discord.gg/BGEA4HxY8u',
        steamID: '/steam/76561198403361404'
    }];

    let fireworksInstance;

    function playAudio() {
        const audio = document.getElementById('wololo-audio');
        audio.volume = 0.3; // Set the volume to 30%
        audio.play().catch(error => console.error('Audio play failed:', error));
        triggerFireworks();
        toggleBlueTheme();
    }

    function triggerFireworks() {
        const container = document.getElementById('fireworks-container');
        if (!fireworksInstance) {
            fireworksInstance = new Fireworks(container, {
                maxRockets: 15, // max # of rockets to spawn
                rocketSpawnInterval: 150, // milliseconds to check if new rockets should spawn
                numParticles: 100, // number of particles to spawn when rocket explodes
                explosionMinHeight: 0.2,
                explosionMaxHeight: 0.9,
                explosionChance: 0.08 // chance in each tick the rocket will explode
            });
        }
        
        fireworksInstance.start();

        setTimeout(() => {
            fireworksInstance.stop();
        }, 10000);
    }

    function toggleBlueTheme() {
        document.body.classList.toggle('blue-theme');
    }

    function shuffleArray(array) {
        for (let i = array.length - 1; i > 0; i--) {
            const j = Math.floor(Math.random() * (i + 1));
            [array[i], array[j]] = [array[j], array[i]];
        }
        return array;
    }

    function generatePlayerList() {
        const shuffledPlayers = shuffleArray(players);
        const playerListContainer = document.getElementById('player-list');
        playerListContainer.innerHTML = '';
        shuffledPlayers.forEach(player => {
            const playerElement = document.createElement('div');
            playerElement.classList.add('player');
            playerElement.innerHTML = `
            <div class="player-info">
            <div>
                <h2>${player.name}</h2>
                <p class="elo" id="elo-1v1-${player.steamID}">1v1 ELO: Loading...</p>
                <p class="elo" id="elo-team-${player.steamID}">Team ELO: Loading...</p>
            </div>
            <div>
                <a href="${player.twitch}" target="_blank" class="twitch-button offline" id="twitch-${player.name}">
                <img src="https://github.com/inertiacreeping/wololo/blob/main/twitch.png?raw=true" class="icon" alt="Twitch">
                <span class="live-text">OFFLINE</span>
                </a>
            </div>
            <div>
                <a href="${player.discordLink}" target="_blank" class="discord-button">
                <img src="https://github.com/inertiacreeping/wololo/blob/main/discord.png?raw=true" class="icon" alt="Discord">
                <span>${player.discordName}</span>
                </a>
            </div>
            </div>
            `;
            playerListContainer.appendChild(playerElement);
        });
     }

    async function fetchEloData() {
    try {
        const response = await fetch('/elo_data.json');
        const data = await response.json();
        data.forEach(playerData => {
            document.getElementById(`elo-1v1-${playerData.steamID}`).textContent = `1v1 ELO: ${playerData.elo1v1}`;
            document.getElementById(`elo-team-${playerData.steamID}`).textContent = `Team ELO: ${playerData.eloTeam}`;
        });
    } catch (error) {
        console.error('Error fetching ELO data:', error);
        players.forEach(player => {
            document.getElementById(`elo-1v1-${player.steamID}`).textContent = '1v1 ELO: N/A';
            document.getElementById(`elo-team-${player.steamID}`).textContent = 'Team ELO: N/A';
        });
    }}

    async function checkLiveStatus() {
        for (const player of players) {
            const statusElement = document.getElementById(`twitch-${player.name}`);
            if (!statusElement) {
                console.error(`Element with ID twitch-${player.name} not found`);
                continue;
            }

        try {
            const response = await fetch(`https://api.twitch.tv/helix/streams?user_login=${player.name}`, {
                headers: {
                    'Client-ID': ${clientId},
                    'Authorization': `Bearer ${accessToken}`
                }
            });
            const data = await response.json();
            console.log(`Streamer: ${player.name}`, data); // Log the data for each streamer
            const statusSpan = statusElement.querySelector('.live-text');
            if (data.data && data.data.length > 0 && data.data[0].type === 'live') {
                statusSpan.textContent = 'LIVE';
                statusSpan.classList.add('flash');
                statusElement.classList.remove('offline');
                statusElement.classList.add('live');
            } else {
                statusSpan.textContent = 'OFFLINE';
                statusSpan.classList.remove('flash');
                statusElement.classList.remove('live');
                statusElement.classList.add('offline');
            }
        } catch (error) {
            console.error(`Error fetching status for ${player.name}:`, error);
            const statusSpan = statusElement.querySelector('.live-text');
            statusSpan.textContent = 'ERROR';
            statusSpan.classList.remove('flash');
            statusElement.classList.remove('live', 'offline');
            statusElement.style.color = 'orange';
        }}
    }
    document.addEventListener('DOMContentLoaded', () => {
        generatePlayerList();
        fetchEloData();
        checkLiveStatus();
        setInterval(checkLiveStatus, 30000); // Check every 30 seconds
    });
</script>
</body>
</html>
